udelat komunikaci
doplnit menu
    -BT Sparovana (odstranit)
    -BT Info

    -MIDI Stav
    -MIDI Loopback


scrollovani v menu
zprovoznit led


	//Precte se typ zpravy
	uint8_t msgType = midiFifo[0];

	//Pokud prijde byte validni MIDI zpravy
	if((msgType & 0xF0) >= 0x80 && !midiGotMessage){
		midiGotMessage = 1;
		//Zpravy co maji 2 byty
		if((msgType >= 0x80 && msgType <= 0xBF) || (msgType & 0xF0) == 0xE0 || msgType == 0xF2 || msgType == 0xF0){
			dma_set_memory_address(DMA1, DMA_CHANNEL4, (uint32_t)&midiFifo[midiFifoIndex]);
    		dma_set_number_of_data(DMA1, DMA_CHANNEL4, 2);
			midiFifoIndex += 2;
		}else if((msgType & 0xF0) == 0xC0 ||  (msgType & 0xF0) == 0xD0 || msgType == 0xF3){
			dma_set_memory_address(DMA1, DMA_CHANNEL4, (uint32_t)&midiFifo[midiFifoIndex++]);
    		dma_set_number_of_data(DMA1, DMA_CHANNEL4, 1);
		}else{
			midiFifoIndex = 0;
			dma_set_memory_address(DMA1, DMA_CHANNEL4, (uint32_t)&midiFifo[midiFifoIndex++]);
    		dma_set_number_of_data(DMA1, DMA_CHANNEL4, 1);
		}


	}else if(midiGotMessage){
		//Pokud byla zprava sysex a prisel sysex end
		if(msgType == 0xF0 && midiFifo[midiFifoIndex-1] == 0xF7){
			midiFifoIndex = 0;
			midiFifo[midiFifoIndex] = 0;
			midiGotMessage = 0;
			dma_set_memory_address(DMA1, DMA_CHANNEL4, (uint32_t)&midiFifo[midiFifoIndex++]);
    		dma_set_number_of_data(DMA1, DMA_CHANNEL4, 1);
		}else if(msgType == 0xF0 && midiFifo[midiFifoIndex-1] != 0xF7){
			//Pokud byla zprava sysex a prisly data
			dma_set_memory_address(DMA1, DMA_CHANNEL4, (uint32_t)&midiFifo[midiFifoIndex++]);
    		dma_set_number_of_data(DMA1, DMA_CHANNEL4, 1);
		}else{
			//Ostatni zpravy
			uint8_t buffer[4];
			//Vynuluje se buffer
			memset(buffer,0,4);
			//Vytvori se CN a CIN
			buffer[0] = ((midiFifo[0] >> 4) & 0x0F);
			//Data se presunou do bufferu
			memcpy(&buffer[1], &midiFifo[0], midiFifoIndex);

			usb_midi_tx(buffer, 4);
			//Zacne se novy prijem
			midiFifoIndex = 0;
			midiGotMessage = 0;
			midiFifo[midiFifoIndex] = 0;
			dma_set_memory_address(DMA1, DMA_CHANNEL4, (uint32_t)&midiFifo[midiFifoIndex++]);
    		dma_set_number_of_data(DMA1, DMA_CHANNEL4, 1);
		}
	}else{
		//Pokud nema validni MIDI zpravu, prijima dal
		midiGotMessage = 0;
		midiFifoIndex = 0;
		midiFifo[midiFifoIndex] = 0;
		dma_set_memory_address(DMA1, DMA_CHANNEL4, (uint32_t)&midiFifo[midiFifoIndex++]);
    	dma_set_number_of_data(DMA1, DMA_CHANNEL4, 1);
	}